# @package _group_
name: "Sweep SL TD transformerCLS mediapipe_keypoints handsandbody"
project: SLTopicDetection_sweep
program: fairseq-hydra-train

method: random #"grid", "random", "bayes"

metric:
  goal: maximize
  name: val/acc

parameters:
  task.feats_type:
    values: ['mediapipe_keypoints']
    #  dataset.max_tokens:
    # values: [40000]
  dataset.batch_size:
    values: [16, 32, 64]
  task.normalization: #We should check which other ones are similar
    values: ["layer_norm"]
  model.encoder_layers:
    values: [2,3,4, 5]
  model.encoder_attention_heads:
    values: [2,4,8]
  model.encoder_ffn_embed_dim:
    values: [512, 1024]
  model.encoder_embed_dim:
    values: [128, 256, 512]
  model.dropout:
    values: [0.0, 0.1, 0.2]
  optimization.lr:
    values: [[2e-3], [1e-3], [5e-4], [2e-4], [1e-4], [5e-5]]
  optimizer.weight_decay: #This should help with the overfitting
    values: [0.001,0.005,0.01]
  criterion._name:
    values: [focal_loss]
  criterion.alpha:
    values:
      - "0.032935\\,0.033554\\,0.131136\\,0.103578\\,0.052167\\,0.072557\\,0.051789\\,0.111670\\,0.255246\\,0.155367"
      - "0.1\\,0.1\\,0.1\\,0.1\\,0.1\\,0.1\\,0.1\\,0.1\\,0.1\\,0.1"
  criterion.gamma: #When it is zero, this is weighted cross entropy. And with values to 1, it is regular cross entropy.
    values: [0.0, 1.0, 2.0, 3.0]

# TODO: checkpoint.save_dir should have a name associated to each of the runs.
command:
  - ${program}
  - ${args_no_hyphens}
  - "task.data=/home/ltarres/temp_data/How2Sign/TopicDetection/mediapipe_keypoints"
  - "task.dict_path=/home/ltarres/temp_data/How2Sign/TopicDetection/mediapipe_keypoints/categoryName_categoryID.csv"
  - "task.feats_type=mediapipe_keypoints"
  - "task.dataset='How2Sign'"
  - "checkpoint.save_dir=/home/ltarres/temp_data/How2Sign/TopicDetection/laia_final_models/transformerCLS_mediapipe_keypoints_2d_pose_sweep"
  - "bpe.sentencepiece_model=/home/ltarres/temp_data/How2Sign/TopicDetection/text/spm_unigram8000_en.model"
  - "checkpoint.no_last_checkpoints=True"
  - "checkpoint.restore_file=checkpoint_none.pt"
  - "--config-dir"
  - "./config_pose"
  - "--config-name"
  - "baseline_transformerCLS_mediapipe_keypoints_2d_pose_handsandbody"
